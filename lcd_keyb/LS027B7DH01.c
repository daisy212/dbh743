
#include "RTOS.h"
#include "SEGGER_RTT.h" // utilisation SEGGER_RTT_printf

#include "LS027B7DH01.h"

/**************************************************************************
    Sharp Memory Display Connector, Adafruit
    -----------------------------------------------------------------------
    Pin   Function        Notes
    ===   ==============  ===============================
      1   VIN             3.3-5.0V (into LDO supply)
      2   3V3             3.3V out
      3   GND
      4   SCLK            Serial Clock
      5   MOSI            Serial Data Input
      6   CS              Serial Chip Select
      7   EXTCOMIN        External COM Inversion Signal, 10k 0v
      8   DISP            Display On(High)/Off(Low), 10k 3v3
      9   EXTMODE         COM Inversion Select (Low = SW clock/serial), 10k 0v

 **************************************************************************/

//#define DEBUG_LCD 1
#define MIRROR 1

extern uint32_t Cnt_ms ; 
/*
 * Implementation
 */

/* Static memory allocation */

uint8_t lcd_framebuffer[LCD_TOTAL_BYTES] = {0};

static uint8_t  __attribute__((aligned(32))) lcd_dma_buffer[LCD_MAX_DMA_SIZE] = {0};


const char LCD_status_Desc[LCD_LAST][LCD_MESSAGE_LENGTH] = {
"ok",
    "ERROR",
    "BUSY",
    "TIMEOUT",
	"DMA1",
	"DMA2"

};


/* Private variables */
static LCD_Handle_t *g_hlcd = NULL; // Global handle for DMA callback

/* Private function prototypes */
static LCD_Status_t LCD_SendCommand(LCD_Handle_t *hlcd, uint8_t cmd);
static uint16_t LCD_BuildDMABuffer(LCD_Handle_t *hlcd, uint8_t *buffer);
static void LCD_UpdateModifiedRange(LCD_Handle_t *hlcd, uint16_t line);


extern SPI_HandleTypeDef	hspi4;
extern DMA_HandleTypeDef hdma_spi4_tx;
#define HSPILCD				hspi4
LCD_Handle_t				hlcd;


void LCD_SPI_TxCpltCallback(SPI_HandleTypeDef *spi);
uint8_t MX_SPI4_Init(void);
void MX_DMA_Init(void);


/**
 * @brief Initialize the LCD driver
 * @param hlcd: LCD handle
 * @param hspi: SPI handle (must be pre-configured)
 * @param use_dma: Enable DMA transfers
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_Sharp_Init(LCD_Handle_t *hlcd, bool use_dma)
{
    if (!hlcd) {
        return LCD_ERROR;
    }

	#define LCD_CS_Pin GPIO_PIN_11
#define LCD_CS_GPIO_Port GPIOE
#define LCD_OFF_Pin GPIO_PIN_13
#define LCD_OFF_GPIO_Port GPIOE


  HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
  HAL_GPIO_WritePin(LCD_OFF_GPIO_Port, LCD_OFF_Pin, GPIO_PIN_SET);
  GPIO_InitTypeDef GPIO_InitStruct = {0};

	  /*Configure GPIO pins : LED_Pin LCD_CS_Pin LCD_OFF_Pin */
  GPIO_InitStruct.Pin = LCD_OFF_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(LCD_OFF_GPIO_Port, &GPIO_InitStruct);

  GPIO_InitStruct.Pin = LCD_CS_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_MEDIUM;
  HAL_GPIO_Init(LCD_CS_GPIO_Port, &GPIO_InitStruct);



/* config clock & pin, 
	HAL_SPI_MspInit( &HSPILCD);
	spi4 clk = HSE, 25Mhz Ã  diviser par 16 ou 8
included in MX_SPI4_Init()
*/
	MX_DMA_Init();

	uint8_t err_spi4b= MX_SPI4_Init();
	if ( err_spi4b!= 0) return LCD_ERROR;

    /* Initialize handle */
    memset(hlcd, 0, sizeof(LCD_Handle_t));
    hlcd->config.hspi = &HSPILCD;
    hlcd->config.use_dma = use_dma;
    hlcd->config.timeout_ms = 1000;
    hlcd->vcom_state = false;
    hlcd->transfer_complete = true;

    /* Initialize modified lines tracking */
    memset(&hlcd->modified, 0, sizeof(LCD_ModifiedLines_t));
    hlcd->modified.first_modified = LCD_HEIGHT;
    hlcd->modified.last_modified = 0;

    /* Set global handle for DMA callback */
    g_hlcd = hlcd;

    /* Verify SPI configuration */
    if (hlcd->config.hspi->Init.DataSize != SPI_DATASIZE_8BIT) {
        return LCD_ERROR;
    }
HAL_StatusTypeDef status2;
/* modif suppression spi avec callback, utilisation weak
//	status2 = HAL_SPI_RegisterCallback( hlcd->config.hspi, HAL_SPI_TX_COMPLETE_CB_ID, &LCD_SPI_TxCpltCallback);


#ifdef  DEBUG_LCD
	SEGGER_RTT_printf(0, "\nSPI2 register CB (0 = ok) %02x ", (int)status2 );
#endif
	if (status2 != HAL_OK)	{
        return LCD_ERROR;
    }
*/

    /* Clear static buffers */
    memset(lcd_framebuffer, 0, LCD_TOTAL_BYTES);
    memset(lcd_dma_buffer, 0, LCD_MAX_DMA_SIZE);
 
    hlcd->initialized = true; // LCD_Clear() check initialized !

    /* Clear display */
    LCD_Status_t status = LCD_Clear(hlcd);
    if (status != LCD_OK) {
        return status;
    }

    return LCD_OK;
}

/**
 * @brief Get pointer to the framebuffer
 * @retval uint8_t*: Pointer to framebuffer
 */
uint8_t* LCD_GetFramebuffer(void)
{
    return lcd_framebuffer;
}


/**
 * @brief Get pointer to DMA buffer
 * @retval uint8_t*: Pointer to DMA buffer
 */
uint8_t* LCD_GetDMABuffer(void)
{
    return lcd_dma_buffer;
}

/**
 * @brief Get pointer to modified lines table
 * @retval bool*: Pointer to modified lines boolean array
 */
bool* LCD_GetModifiedLinesTable(void)
{
    return (g_hlcd) ? g_hlcd->modified.lines : NULL;
}




/**
 * @brief Deinitialize the LCD driver
 * @param hlcd: LCD handle
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_DeInit(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return LCD_ERROR;
    }

    /* Wait for any ongoing transfer */
    LCD_WaitForTransfer(hlcd);

    /* Clear display */
    LCD_Clear(hlcd);

    /* Clear static buffers */
    memset(lcd_framebuffer, 0, LCD_TOTAL_BYTES);
    memset(lcd_dma_buffer, 0, LCD_MAX_DMA_SIZE);

    hlcd->initialized = false;
    g_hlcd = NULL;

    return LCD_OK;
}


/**
 * @brief Clear the entire display
 * @param hlcd: LCD handle
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_Clear(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return LCD_ERROR;
    }

    /* Wait for any ongoing transfer */
    LCD_Status_t status = LCD_WaitForTransfer(hlcd);
    if (status != LCD_OK) {
        return status;
    }

    /* Toggle VCOM */
    LCD_ToggleVCOM(hlcd);

    /* Send clear command */
    uint8_t cmd = LCD_CMD_CLEAR_ALL | (hlcd->vcom_state ? LCD_CMD_VCOM : 0);
    status = LCD_SendCommand(hlcd, cmd);
    if (status != LCD_OK) {
        return status;
    }

    /* Clear framebuffer and modified lines */
    memset(lcd_framebuffer, 0xff, LCD_TOTAL_BYTES);
    LCD_ClearModifiedLines(hlcd);

    return LCD_OK;
}

/**
 * @brief Clear the entire display
 * @param hlcd: LCD handle
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_ClearFramebuffer(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return LCD_ERROR;
    }
    /* Clear framebuffer and modified lines */
    memset(lcd_framebuffer, 0xff, LCD_TOTAL_BYTES);
    LCD_ClearModifiedLines(hlcd);

    return LCD_OK;
}


/**
 * @brief Update the entire display with framebuffer content
 * @param hlcd: LCD handle
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_UpdateDisplay(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return LCD_ERROR;
    }

    /* Mark all lines as modified */
    LCD_MarkAllLinesModified(hlcd);

    /* Update all modified lines */
    return LCD_UpdateModifiedLines(hlcd);
}


/**
 * @brief Update only the modified lines in a single DMA transfer
 * @param hlcd: LCD handle
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_UpdateModifiedLines(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return LCD_ERROR;
    }

    /* Check if there are any changes */
    if (!hlcd->modified.has_changes || hlcd->modified.count == 0) {
        return LCD_OK;
    }

    /* Wait for any ongoing transfer */
    LCD_Status_t status = LCD_WaitForTransfer(hlcd);
    if (status != LCD_OK) {
        return status;
    }

    /* Toggle VCOM */
    LCD_ToggleVCOM(hlcd);

    /* Build DMA buffer with only modified lines 
	   And clear modified lines
	*/
    uint16_t dma_size = LCD_BuildDMABuffer(hlcd, lcd_dma_buffer);

    if (dma_size == 0) {
        return LCD_OK;
    }
// for h7, clean Dcache
SCB_CleanDCache_by_Addr((uint32_t*)lcd_dma_buffer, sizeof(lcd_dma_buffer));


    /* Send data */
    hlcd->transfer_complete = false;

    if (hlcd->config.use_dma) {
			/* Single DMA transfer with all modified lines */
			HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);
			HAL_StatusTypeDef hal_status = HAL_SPI_Transmit_DMA(hlcd->config.hspi, 
                                                           lcd_dma_buffer, 
                                                           dma_size);
	        if (hal_status != HAL_OK) {
	            hlcd->transfer_complete = true;
	            return LCD_DMA1;
	        }
    } else {
        /* Polling transfer */
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);
        HAL_StatusTypeDef hal_status = HAL_SPI_Transmit(hlcd->config.hspi, 
                                                       lcd_dma_buffer, 
                                                       dma_size, 
                                                       hlcd->config.timeout_ms);
        hlcd->transfer_complete = true;
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);

        if (hal_status != HAL_OK) {
            return LCD_DMA2;
        }
    }
    return LCD_OK;
}


/**
 * @brief Set a pixel in the framebuffer
 * @param hlcd: LCD handle
 * @param x: X coordinate (0 to LCD_WIDTH-1)
 * @param y: Y coordinate (0 to LCD_HEIGHT-1)
 * @param pixel: Pixel state (true = 1, 0 = white, -1 : invert)
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_SetPixel(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, int8_t pixel)
{
    if (!hlcd || !hlcd->initialized || x >= LCD_WIDTH || y >= LCD_HEIGHT) {
        return LCD_ERROR;
    }
#if  MIRROR 
	x = LCD_WIDTH -x -1;
#endif

    uint32_t byte_index = (y * LCD_BYTES_PER_LINE) + (x / 8);
    uint8_t bit_index = x % 8;
    uint8_t old_value = lcd_framebuffer[byte_index];

    if (pixel==0) {
        lcd_framebuffer[byte_index] |= (1 << bit_index);
    } 
	else    if (pixel==-1) {
        lcd_framebuffer[byte_index] ^= (1 << bit_index);
    } 
	else if (pixel== 1){
        lcd_framebuffer[byte_index] &= ~(1 << bit_index);
    }

    /* Mark line as modified if pixel actually changed */
    if (lcd_framebuffer[byte_index] != old_value) {
        LCD_MarkLineModified(hlcd, y);
    }

    return LCD_OK;
}


/**
 * @brief Get a pixel from the framebuffer
 * @param hlcd: LCD handle
 * @param x: X coordinate (0 to LCD_WIDTH-1)
 * @param y: Y coordinate (0 to LCD_HEIGHT-1)
 * @retval bool: Pixel state (true = black, false = white)
 */
bool LCD_GetPixel(LCD_Handle_t *hlcd, uint16_t x, uint16_t y)
{
    if (!hlcd || !hlcd->initialized || x >= LCD_WIDTH || y >= LCD_HEIGHT) {
        return false;
    }

    uint32_t byte_index = (y * LCD_BYTES_PER_LINE) + (x / 8);
    uint8_t bit_index = x % 8;

    return (lcd_framebuffer[byte_index] & (1 << bit_index)) == 0;
}


/**
 * @brief Fill a rectangle in the framebuffer
 * @param hlcd: LCD handle
 * @param x: X coordinate of top-left corner
 * @param y: Y coordinate of top-left corner
 * @param w: Width in pixels
 * @param h: Height in pixels
 * @param pixel: Pixel state (1 = black, 0 = white, -1 = toggle)
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_FillRect(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, uint16_t w, uint16_t h, int8_t pixel)
{
    if (!hlcd || !hlcd->initialized) {
        return LCD_ERROR;
    }

    /* Clip rectangle to display bounds */
    if (x >= LCD_WIDTH || y >= LCD_HEIGHT) {
        return LCD_OK;
    }
    if (x + w > LCD_WIDTH) {
        w = LCD_WIDTH - x;
    }
    if (y + h > LCD_HEIGHT) {
        h = LCD_HEIGHT - y;
    }

    /* Fill rectangle and track modified lines */
    for (uint16_t dy = 0; dy < h; dy++) {
        uint16_t line = y + dy;
        bool line_changed = false;
        
        for (uint16_t dx = 0; dx < w; dx++) {
            uint32_t byte_index = (line * LCD_BYTES_PER_LINE) + ((x + dx) / 8);
            uint8_t bit_index = (x + dx) % 8;
            uint8_t old_value = lcd_framebuffer[byte_index];

            if (pixel == 0) {
                lcd_framebuffer[byte_index] |= (1 << bit_index);
            } 
			else if (pixel == -1) {
                lcd_framebuffer[byte_index] ^= (1 << bit_index);
            } 
			else {
                lcd_framebuffer[byte_index] &= ~(1 << bit_index);
            }

            if (lcd_framebuffer[byte_index] != old_value) {
                line_changed = true;
            }
        }

        if (line_changed) {
            LCD_MarkLineModified(hlcd, line);
        }
    }

    return LCD_OK;
}


/**
 * @brief Mark a specific line as modified
 * @param hlcd: LCD handle
 * @param line: Line number (0 to LCD_HEIGHT-1)
 */
void LCD_MarkLineModified(LCD_Handle_t *hlcd, uint16_t line)
{
    if (!hlcd || !hlcd->initialized || line >= LCD_HEIGHT) {
        return;
    }

    if (!hlcd->modified.lines[line]) {
        hlcd->modified.lines[line] = true;
        hlcd->modified.count++;
        hlcd->modified.has_changes = true;
        LCD_UpdateModifiedRange(hlcd, line);
    }
}

/**
 * @brief Mark all lines as modified
 * @param hlcd: LCD handle
 */
void LCD_MarkAllLinesModified(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return;
    }

    memset(hlcd->modified.lines, true, LCD_HEIGHT);
    hlcd->modified.count = LCD_HEIGHT;
    hlcd->modified.first_modified = 0;
    hlcd->modified.last_modified = LCD_HEIGHT - 1;
    hlcd->modified.has_changes = true;
}

/**
 * @brief Clear all modified line flags
 * @param hlcd: LCD handle
 */
void LCD_ClearModifiedLines(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return;
    }

    memset(hlcd->modified.lines, false, LCD_HEIGHT);
    hlcd->modified.count = 0;
    hlcd->modified.first_modified = LCD_HEIGHT;
    hlcd->modified.last_modified = 0;
    hlcd->modified.has_changes = false;
}

/**
 * @brief Get number of modified lines
 * @param hlcd: LCD handle
 * @retval uint16_t: Number of modified lines
 */
uint16_t LCD_GetModifiedLinesCount(LCD_Handle_t *hlcd)
{
    if (!hlcd || !hlcd->initialized) {
        return 0;
    }

    return hlcd->modified.count;
}

/**
 * @brief Toggle VCOM state (must be called periodically)
 * @param hlcd: LCD handle
 * it's only a boolean flag, no direct action on display, soft VCOM
 */
void LCD_ToggleVCOM(LCD_Handle_t *hlcd)
{
    if (hlcd) {
        hlcd->vcom_state = !hlcd->vcom_state;
    }
}


/**
 * @brief Wait for transfer completion
 * @param hlcd: LCD handle
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_WaitForTransfer(LCD_Handle_t *hlcd)
{
    if (!hlcd) {
        return LCD_ERROR;
    }

    uint32_t timeout = Cnt_ms + hlcd->config.timeout_ms;

    while (!hlcd->transfer_complete) {
        if (Cnt_ms > timeout) {
            return LCD_TIMEOUT;
        }
    }

    return LCD_OK;
}


/**
 * @brief SPI transfer complete callback
 * @param spi: SPI handle
 utilisation des fonctions weak
 */
 
void HAL_SPI_TxCpltCallback(SPI_HandleTypeDef *spi)
//void LCD_SPI_TxCpltCallback(SPI_HandleTypeDef *spi)
{
  	HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
	if ((g_hlcd)&& (spi->Instance == SPI4))  {

#ifdef  DEBUG_LCD
		HAL_SPI_StateTypeDef status = HAL_SPI_GetState(spi);
		SEGGER_RTT_printf(0, "\nSPI4 Ended Call back Status ( 1 ready) %02x ", (int)status );
#endif
        g_hlcd->transfer_complete = true;
        /* Clear modified lines after successful DMA transfer  NO at the end of dma_buff contruction */
    }
}



/******************************************************************************/
/* STM32U5xx Peripheral Interrupt Handlers                                    */
/* Add here the Interrupt Handlers for the used peripherals.                  */
/* For the available peripheral interrupt handler names,                      */
/* please refer to the startup file (startup_stm32u5xx.s).                    */
/******************************************************************************/

/**
  * @brief This function handles GPDMA1 Channel 0 global interrupt.
  */
void DMA1_Stream0_IRQHandler(void)
{


HAL_DMA_IRQHandler(&hdma_spi4_tx);

  /* USER CODE BEGIN GPDMA1_Channel0_IRQn 0 */


if (g_hlcd) {
//        g_hlcd->transfer_complete = true;
        /* Clear modified lines after successful DMA transfer */
 //       LCD_ClearModifiedLines(g_hlcd);
    }


//HAL_DMA_StateTypeDef status = HAL_DMA_GetState(&hdma_spi4_tx);
//SEGGER_RTT_printf(0, "\nDMA0 Status (2 = ongoing) %02x ", (int)status );

  /* USER CODE END GPDMA1_Channel0_IRQn 0 */
//  HAL_DMA_IRQHandler(&handle_GPDMA1_Channel0);
  /* USER CODE BEGIN GPDMA1_Channel0_IRQn 1 */
    

  /* USER CODE END GPDMA1_Channel0_IRQn 1 */
}


/**
  * @brief Tx Half Transfer completed callback.
  * @param  hspi: pointer to a SPI_HandleTypeDef structure that contains
  *               the configuration information for SPI module.
  * @retval None
  */
void HAL_SPI_TxHalfCpltCallback(SPI_HandleTypeDef *hspi) /* Derogation MISRAC2012-Rule-8.13 */
{
  /* Prevent unused argument(s) compilation warning */
 // UNUSED(hspi);

	if ((g_hlcd)&& (hspi->Instance == SPI4))  {
#ifdef  DEBUG_LCD
		HAL_SPI_StateTypeDef status = HAL_SPI_GetState(hspi);
		SEGGER_RTT_printf(0, "\nSPI4 Half Transfer complete ( 1 ready) %02x ", (int)status );
#endif

    }
}


/**
  * @brief This function handles SPI4 global interrupt.
  */
void SPI4_IRQHandler(void)
{
  /* USER CODE BEGIN SPI4_IRQn 0 */

  /* USER CODE END SPI4_IRQn 0 */
  HAL_SPI_IRQHandler(&hspi4);
  /* USER CODE BEGIN SPI4_IRQn 1 */

  /* USER CODE END SPI4_IRQn 1 */
}




/**
 * @brief Send a command to the LCD
 * @param hlcd: LCD handle
 * @param cmd: Command byte
 * @retval LCD_Status_t
 */
static LCD_Status_t LCD_SendCommand(LCD_Handle_t *hlcd, uint8_t cmd)
{
    lcd_dma_buffer[0] = cmd;
    lcd_dma_buffer[1] = 0x00; // Dummy byte

    hlcd->transfer_complete = false;

    HAL_StatusTypeDef hal_status;
    if (hlcd->config.use_dma) {

		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);
        hal_status = HAL_SPI_Transmit_DMA(hlcd->config.hspi, lcd_dma_buffer, 2);
        if (hal_status != HAL_OK) {
            hlcd->transfer_complete = true;
            return LCD_ERROR;
        }
    } else {
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET);

        hal_status = HAL_SPI_Transmit(hlcd->config.hspi, lcd_dma_buffer, 2, hlcd->config.timeout_ms);
		HAL_GPIO_WritePin(LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET);
        hlcd->transfer_complete = true;
        if (hal_status != HAL_OK) {
            return LCD_ERROR;
        }
    }

    return LCD_OK;
}


/**
 * @brief Build DMA buffer with only modified lines
 * @param hlcd: LCD handle
 * @param buffer: DMA buffer to fill
 * clear modified flags
 * @retval uint16_t: Size of data in buffer (0 on error)
 */
static uint16_t LCD_BuildDMABuffer(LCD_Handle_t *hlcd, uint8_t *buffer)
{
    if (!hlcd || !buffer || !hlcd->modified.has_changes) {
        return 0;
    }

    uint16_t buffer_index = 0;
    uint8_t base_cmd = LCD_CMD_WRITE_LINE | (hlcd->vcom_state ? LCD_CMD_VCOM : 0);

    /* Add only modified lines to buffer */
    for (uint16_t line = 0; line < LCD_HEIGHT; line++) {
        if ((hlcd->modified.lines[line]) ||
		((line >= hlcd->modified.first_modified)&&
		 (line <= hlcd->modified.last_modified)&&0))
		
		{
            /* Command byte */
            buffer[buffer_index++] = base_cmd;
            
            /* Line number (1-based) */
            buffer[buffer_index++] = (uint8_t)(line + 1);
            

#if MIRROR 
            uint32_t line_offset = (line+1) * LCD_BYTES_PER_LINE;
			for (int32_t ii = 0; ii<	LCD_BYTES_PER_LINE; ii++){
				uint8_t data = lcd_framebuffer[--line_offset];
				data = (data & 0xF0) >> 4 | (data & 0x0F) << 4;
			    data = (data & 0xCC) >> 2 | (data & 0x33) << 2;
				data = (data & 0xAA) >> 1 | (data & 0x55) << 1;
				buffer[buffer_index++] = data;
			}

#else
           /* Copy line data from framebuffer */
            uint32_t line_offset = line * LCD_BYTES_PER_LINE;
            memcpy(&buffer[buffer_index], &lcd_framebuffer[line_offset], LCD_BYTES_PER_LINE);
            buffer_index += LCD_BYTES_PER_LINE;
#endif


        }
    }

    /* Add final dummy byte */
    buffer[buffer_index++] = 0x00;
	LCD_ClearModifiedLines(hlcd);
    return buffer_index;
}


/**
 * @brief Update modified line range tracking
 * @param hlcd: LCD handle
 * @param line: Line number that was modified
 */
static void LCD_UpdateModifiedRange(LCD_Handle_t *hlcd, uint16_t line)
{
    if (line < hlcd->modified.first_modified) {
        hlcd->modified.first_modified = line;
    }
    if (line > hlcd->modified.last_modified) {
        hlcd->modified.last_modified = line;
    }
}

/**
 * @brief Draw a segment using Bresenham's algorithm
 * @param hlcd: LCD handle
 * @param x0, y0 : coordinates of first point
 * @param x1, y1 : coordinates of second point
 * @param pixel: Pixel state (1 = black, 0 = white, -1 = toggle)
 * @retval LCD_Status_t
 */
void LCD_DrawLine(LCD_Handle_t *hlcd,uint16_t x0, uint16_t y0, uint16_t x1, uint16_t y1, int8_t pixel) 
{
    int16_t dx = abs(x1 - x0);
    int16_t dy = abs(y1 - y0);
    int16_t sx = (x0 < x1) ? 1 : -1;
    int16_t sy = (y0 < y1) ? 1 : -1;
    int16_t err = dx - dy;
    
    while (1) {
        LCD_SetPixel(hlcd, x0, y0, pixel);
        
        if (x0 == x1 && y0 == y1) break;
        
        int16_t e2 = 2 * err;
        if (e2 > -dy) {
            err -= dy;
            x0 += sx;
        }
        if (e2 < dx) {
            err += dx;
            y0 += sy;
        }
    }
}



/**
 * @brief Draw a rectangle in the framebuffer
 * @param hlcd: LCD handle
 * @param x: X coordinate of top-left corner
 * @param y: Y coordinate of top-left corner
 * @param w: Width in pixels
 * @param h: Height in pixels
 * @param pixel: Pixel state (1 = black, 0 = white, -1 = toggle)
 * @retval LCD_Status_t
 */
// Draw rectangle outline
void LCD_DrawRect(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, uint16_t w, uint16_t h, int8_t pixel) 
{
    LCD_DrawLine(hlcd, x, y, x + w - 1, y, pixel);              // Top
    LCD_DrawLine(hlcd, x, y + h - 1, x + w - 1, y + h - 1, pixel); // Bottom
    LCD_DrawLine(hlcd, x, y, x, y + h - 1, pixel);              // Left
    LCD_DrawLine(hlcd, x + w - 1, y, x + w - 1, y + h - 1, pixel); // Right
}


// Cascadia Code inspired font 12x24 bitmap for ASCII characters (32-126)
// Each character is 12 pixels wide, 24 pixels tall
// Each row is stored as 2 bytes (16 bits, using lower 12 bits)
static const uint16_t __attribute__((section(".FLASH2"))) cascadia_font_12x24[][24] = 
{
    // Space (32)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ! (33)
    {0x000, 0x000, 0x060, 0x060, 0x060, 0x060, 0x060, 0x060, 0x060, 0x060, 0x060, 0x060,
     0x060, 0x060, 0x000, 0x000, 0x060, 0x060, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // " (34)
    {0x000, 0x000, 0x198, 0x198, 0x198, 0x198, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // # (35)
    {0x000, 0x000, 0x000, 0x198, 0x198, 0x198, 0x7FE, 0x198, 0x198, 0x330, 0x330, 0x7FE,
     0x330, 0x330, 0x330, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // $ (36)
    {0x000, 0x000, 0x030, 0x0FC, 0x1FE, 0x330, 0x330, 0x330, 0x1F0, 0x0FC, 0x03E, 0x033,
     0x033, 0x330, 0x1FE, 0x0FC, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // % (37)
    {0x000, 0x000, 0x000, 0x1C0, 0x360, 0x360, 0x1CC, 0x018, 0x030, 0x060, 0x0C0, 0x198,
     0x336, 0x336, 0x01C, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // & (38)
    {0x000, 0x000, 0x000, 0x078, 0x0CC, 0x0CC, 0x0CC, 0x078, 0x1BC, 0x3CE, 0x3C6, 0x3C6,
     0x3C6, 0x1CE, 0x0FF, 0x079, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ' (39)
    {0x000, 0x000, 0x060, 0x060, 0x060, 0x060, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ( (40)
    {0x000, 0x000, 0x018, 0x030, 0x060, 0x060, 0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0C0,
     0x0C0, 0x0C0, 0x060, 0x060, 0x030, 0x018, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ) (41)
    {0x000, 0x000, 0x180, 0x0C0, 0x060, 0x060, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x060, 0x060, 0x0C0, 0x180, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // * (42)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x066, 0x03C, 0x0FF, 0x03C, 0x066, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // + (43)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x030, 0x030, 0x030, 0x3FC, 0x030, 0x030, 0x030,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // , (44)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x060, 0x060, 0x060, 0x0C0, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // - (45)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x1FE, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // . (46)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x060, 0x060, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // / (47)
    {0x000, 0x000, 0x006, 0x006, 0x00C, 0x00C, 0x018, 0x018, 0x030, 0x030, 0x060, 0x060,
     0x0C0, 0x0C0, 0x180, 0x180, 0x300, 0x300, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 0 (48)
    {0x000, 0x000, 0x000, 0x07C, 0x0FE, 0x1C7, 0x383, 0x383, 0x383, 0x383, 0x383, 0x383,
     0x383, 0x1C7, 0x0FE, 0x07C, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 1 (49)
    {0x000, 0x000, 0x000, 0x030, 0x070, 0x0F0, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x3FC, 0x3FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 2 (50)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x003, 0x003, 0x00E, 0x01C, 0x038, 0x070,
     0x0E0, 0x1C0, 0x3FF, 0x3FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 3 (51)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x003, 0x003, 0x07C, 0x07C, 0x003, 0x003,
     0x003, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 4 (52)
    {0x000, 0x000, 0x000, 0x00E, 0x01E, 0x036, 0x066, 0x0C6, 0x186, 0x306, 0x3FF, 0x3FF,
     0x006, 0x006, 0x006, 0x006, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 5 (53)
    {0x000, 0x000, 0x000, 0x1FF, 0x1FF, 0x180, 0x180, 0x180, 0x1FC, 0x1FE, 0x003, 0x003,
     0x003, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 6 (54)
    {0x000, 0x000, 0x000, 0x07C, 0x0FE, 0x1C0, 0x380, 0x380, 0x3FC, 0x3FE, 0x383, 0x383,
     0x383, 0x1C7, 0x0FE, 0x07C, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 7 (55)
    {0x000, 0x000, 0x000, 0x3FF, 0x3FF, 0x003, 0x006, 0x00C, 0x018, 0x030, 0x060, 0x060,
     0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 8 (56)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x307, 0x1FE, 0x1FE, 0x307, 0x303,
     0x303, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // 9 (57)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x303, 0x1FF, 0x0FF, 0x007, 0x007,
     0x00E, 0x01C, 0x1F8, 0x0F0, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // : (58)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x060, 0x060, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x060, 0x060, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ; (59)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x060, 0x060, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x060, 0x060, 0x060, 0x0C0, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // < (60)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x00C, 0x018, 0x030, 0x060, 0x0C0, 0x060, 0x030,
     0x018, 0x00C, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // = (61)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x1FE, 0x000, 0x000, 0x1FE, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // > (62)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x180, 0x0C0, 0x060, 0x030, 0x018, 0x030, 0x060,
     0x0C0, 0x180, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ? (63)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x003, 0x003, 0x00E, 0x01C, 0x030, 0x030,
     0x000, 0x000, 0x030, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // @ (64)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x37B, 0x37B, 0x37B, 0x37B, 0x1FB,
     0x180, 0x1C0, 0x0FE, 0x07C, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // A (65)
    {0x000, 0x000, 0x000, 0x078, 0x0FC, 0x18E, 0x307, 0x303, 0x303, 0x3FF, 0x3FF, 0x303,
     0x303, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // B (66)
    {0x000, 0x000, 0x000, 0x3FC, 0x3FE, 0x307, 0x303, 0x307, 0x3FE, 0x3FE, 0x307, 0x303,
     0x303, 0x307, 0x3FE, 0x3FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // C (67)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x300, 0x300, 0x300, 0x300, 0x300, 0x300,
     0x300, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // D (68)
    {0x000, 0x000, 0x000, 0x3F8, 0x3FC, 0x30E, 0x307, 0x303, 0x303, 0x303, 0x303, 0x303,
     0x307, 0x30E, 0x3FC, 0x3F8, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // E (69)
    {0x000, 0x000, 0x000, 0x3FF, 0x3FF, 0x300, 0x300, 0x300, 0x3FC, 0x3FC, 0x300, 0x300,
     0x300, 0x300, 0x3FF, 0x3FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // F (70)
    {0x000, 0x000, 0x000, 0x3FF, 0x3FF, 0x300, 0x300, 0x300, 0x3FC, 0x3FC, 0x300, 0x300,
     0x300, 0x300, 0x300, 0x300, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // G (71)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x300, 0x300, 0x300, 0x31F, 0x31F, 0x303,
     0x303, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // H (72)
    {0x000, 0x000, 0x000, 0x303, 0x303, 0x303, 0x303, 0x303, 0x3FF, 0x3FF, 0x303, 0x303,
     0x303, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // I (73)
    {0x000, 0x000, 0x000, 0x1FE, 0x1FE, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x1FE, 0x1FE, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // J (74)
    {0x000, 0x000, 0x000, 0x01F, 0x01F, 0x003, 0x003, 0x003, 0x003, 0x003, 0x003, 0x303,
     0x303, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // K (75)
    {0x000, 0x000, 0x000, 0x303, 0x307, 0x30E, 0x31C, 0x338, 0x370, 0x3E0, 0x3E0, 0x370,
     0x338, 0x31C, 0x30E, 0x307, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // L (76)
    {0x000, 0x000, 0x000, 0x300, 0x300, 0x300, 0x300, 0x300, 0x300, 0x300, 0x300, 0x300,
     0x300, 0x300, 0x3FF, 0x3FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // M (77)
    {0x000, 0x000, 0x000, 0x383, 0x3C7, 0x3EF, 0x3FF, 0x3BB, 0x393, 0x303, 0x303, 0x303,
     0x303, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // N (78)
    {0x000, 0x000, 0x000, 0x303, 0x383, 0x3C3, 0x3E3, 0x3F3, 0x3BB, 0x31F, 0x30F, 0x307,
     0x303, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // O (79)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // P (80)
    {0x000, 0x000, 0x000, 0x3FC, 0x3FE, 0x307, 0x303, 0x303, 0x307, 0x3FE, 0x3FC, 0x300,
     0x300, 0x300, 0x300, 0x300, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // Q (81)  
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x303, 0x303, 0x303, 0x303, 0x31B,
     0x30F, 0x307, 0x1FE, 0x0FC, 0x006, 0x003, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // R (82)
    {0x000, 0x000, 0x000, 0x3FC, 0x3FE, 0x307, 0x303, 0x303, 0x307, 0x3FE, 0x3FC, 0x338,
     0x31C, 0x30E, 0x307, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // S (83)
    {0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x300, 0x300, 0x1F0, 0x0FC, 0x00E, 0x003,
     0x003, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // T (84)
    {0x000, 0x000, 0x000, 0x3FF, 0x3FF, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x030, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // U (85)
    {0x000, 0x000, 0x000, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // V (86)
    {0x000, 0x000, 0x000, 0x303, 0x303, 0x303, 0x303, 0x307, 0x18E, 0x18C, 0x0D8, 0x0D8,
     0x070, 0x070, 0x030, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // W (87)
    {0x000, 0x000, 0x000, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303, 0x393, 0x3BB, 0x3FF,
     0x3EF, 0x3C7, 0x383, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // X (88)
    {0x000, 0x000, 0x000, 0x307, 0x18E, 0x0DC, 0x078, 0x030, 0x030, 0x078, 0x0DC, 0x18E,
     0x307, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // Y (89)
    {0x000, 0x000, 0x000, 0x307, 0x307, 0x18E, 0x0DC, 0x078, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x030, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // Z (90)
    {0x000, 0x000, 0x000, 0x3FF, 0x3FF, 0x00E, 0x018, 0x030, 0x060, 0x0C0, 0x180, 0x300,
     0x300, 0x380, 0x3FF, 0x3FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // [ (91)
    {0x000, 0x000, 0x0F8, 0x0F8, 0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0C0,
     0x0C0, 0x0C0, 0x0C0, 0x0C0, 0x0F8, 0x0F8, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // \ (92)
    {0x000, 0x000, 0x300, 0x300, 0x180, 0x180, 0x0C0, 0x0C0, 0x060, 0x060, 0x030, 0x030,
     0x018, 0x018, 0x00C, 0x00C, 0x006, 0x006, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ] (93)
    {0x000, 0x000, 0x0F8, 0x0F8, 0x018, 0x018, 0x018, 0x018, 0x018, 0x018, 0x018, 0x018,
     0x018, 0x018, 0x018, 0x018, 0x0F8, 0x0F8, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ^ (94)
    {0x000, 0x000, 0x020, 0x070, 0x0D8, 0x18C, 0x306, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // _ (95)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x3FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ` (96)
    {0x000, 0x000, 0x0C0, 0x060, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // a (97)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x007, 0x0FF, 0x1FF, 0x303,
     0x303, 0x30F, 0x1FF, 0x0F7, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // b (98)
    {0x000, 0x000, 0x300, 0x300, 0x300, 0x300, 0x3FC, 0x3FE, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x3FE, 0x3FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // c (99)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x300, 0x300, 0x300,
     0x300, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // d (100)
    {0x000, 0x000, 0x003, 0x003, 0x003, 0x003, 0x0FF, 0x1FF, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FF, 0x0FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // e (101)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x3FF, 0x300,
     0x300, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // f (102)
    {0x000, 0x000, 0x03E, 0x07F, 0x070, 0x070, 0x3FC, 0x3FC, 0x070, 0x070, 0x070, 0x070,
     0x070, 0x070, 0x070, 0x070, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // g (103)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FF, 0x1FF, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FF, 0x0FF, 0x003, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000},
    
    // h (104)
    {0x000, 0x000, 0x300, 0x300, 0x300, 0x300, 0x3FC, 0x3FE, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // i (105)
    {0x000, 0x000, 0x030, 0x030, 0x000, 0x000, 0x0F0, 0x0F0, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x1FE, 0x1FE, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // j (106)
    {0x000, 0x000, 0x018, 0x018, 0x000, 0x000, 0x078, 0x078, 0x018, 0x018, 0x018, 0x018,
     0x018, 0x018, 0x018, 0x018, 0x018, 0x318, 0x1F0, 0x0E0, 0x000, 0x000, 0x000, 0x000},
    
    // k (107)
    {0x000, 0x000, 0x300, 0x300, 0x300, 0x300, 0x307, 0x30E, 0x31C, 0x338, 0x3F0, 0x3F0,
     0x338, 0x31C, 0x30E, 0x307, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // l (108)
    {0x000, 0x000, 0x0F0, 0x0F0, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x1FE, 0x1FE, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // m (109)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x3EC, 0x3FE, 0x37B, 0x333, 0x333, 0x333,
     0x333, 0x333, 0x333, 0x333, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // n (110)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x3FC, 0x3FE, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x303, 0x303, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // o (111)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FC, 0x1FE, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FE, 0x0FC, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // p (112)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x3FC, 0x3FE, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x3FE, 0x3FC, 0x300, 0x300, 0x300, 0x300, 0x000, 0x000, 0x000, 0x000},
    
    // q (113)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FF, 0x1FF, 0x307, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FF, 0x0FF, 0x003, 0x003, 0x003, 0x003, 0x000, 0x000, 0x000, 0x000},
    
    // r (114)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x1EC, 0x1FE, 0x1C0, 0x180, 0x180, 0x180,
     0x180, 0x180, 0x180, 0x180, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // s (115)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x0FE, 0x1FE, 0x300, 0x1E0, 0x07C, 0x00E,
     0x003, 0x1FF, 0x1FE, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // t (116)
    {0x000, 0x000, 0x000, 0x060, 0x060, 0x060, 0x3FC, 0x3FC, 0x060, 0x060, 0x060, 0x060,
     0x060, 0x067, 0x03F, 0x01E, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // u (117)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x303, 0x303, 0x303, 0x303, 0x303, 0x303,
     0x303, 0x307, 0x1FF, 0x0F7, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // v (118)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x303, 0x303, 0x307, 0x18E, 0x0DC, 0x0D8,
     0x070, 0x070, 0x030, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // w (119)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x303, 0x303, 0x333, 0x333, 0x333, 0x37B,
     0x3FF, 0x3EF, 0x3C7, 0x183, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // x (120)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x307, 0x18E, 0x0DC, 0x078, 0x030, 0x078,
     0x0DC, 0x18E, 0x307, 0x303, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // y (121)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x303, 0x303, 0x307, 0x18E, 0x0DC, 0x0D8,
     0x070, 0x070, 0x030, 0x030, 0x060, 0x1E0, 0x1C0, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // z (122)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x1FF, 0x1FF, 0x00E, 0x01C, 0x038, 0x070,
     0x0E0, 0x1C0, 0x1FF, 0x1FF, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // { (123)
    {0x000, 0x000, 0x03C, 0x07C, 0x060, 0x060, 0x060, 0x060, 0x060, 0x1C0, 0x060, 0x060,
     0x060, 0x060, 0x060, 0x060, 0x07C, 0x03C, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // | (124)
    {0x000, 0x000, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x030,
     0x030, 0x030, 0x030, 0x030, 0x030, 0x030, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // } (125)
    {0x000, 0x000, 0x1E0, 0x1F0, 0x030, 0x030, 0x030, 0x030, 0x030, 0x01C, 0x030, 0x030,
     0x030, 0x030, 0x030, 0x030, 0x1F0, 0x1E0, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000},
    
    // ~ (126)
    {0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x071, 0x1FB, 0x38E, 0x000, 0x000,
     0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000, 0x000}
}; 



// Cascadia Mono, 16x32, baseline-aligned
const uint16_t __attribute__((section(".FLASH2"))) cascadia_font_16x32[][32] = 
{
  // ' ' (ASCII 32)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '!' (ASCII 33)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x0180, 0x0180, 0x0180, 0x0180, 0x0180, 0x0180, 0x0000, 0x0000, 0x01C0, 0x03C0, 0x03C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '"' (ASCII 34)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0E78, 0x0E78, 0x0E78, 0x0E30, 0x0E30, 0x0E30, 0x0E30, 0x0E30, 0x0E30, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '#' (ASCII 35)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0618, 0x0618, 0x0618, 0x0638, 0x0E38, 0x7FFE, 0x7FFE, 0x0E38, 0x0E30, 0x0C30, 0x0C30, 0x0C30, 0x7FFE, 0x7FFE, 0x0C30, 0x1C70, 0x1C70, 0x1C70, 0x1C70, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '$' (ASCII 36)
  { 0x0000, 0x0000, 0x0000, 0x0180, 0x0180, 0x0180, 0x0180, 0x07E0, 0x0FF8, 0x1FFC, 0x3D98, 0x3980, 0x3980, 0x3D80, 0x1F80, 0x0FC0, 0x07F0, 0x01F8, 0x01FC, 0x019C, 0x019C, 0x019C, 0x319C, 0x3FFC, 0x3FF8, 0x0FE0, 0x0180, 0x0180, 0x0180, 0x0180, 0x0000, 0x0000 },
  // '%' (ASCII 37)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1E00, 0x3F00, 0x7380, 0x6180, 0x6180, 0x618E, 0x739E, 0x3F78, 0x1EF0, 0x03C0, 0x07BC, 0x1EFE, 0x3CE7, 0x31C7, 0x21C7, 0x01C7, 0x00E7, 0x00FE, 0x007C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '&' (ASCII 38)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07C0, 0x1FF0, 0x3FF0, 0x3C70, 0x3800, 0x3800, 0x3800, 0x3800, 0x1C00, 0x1E1C, 0x3F1C, 0x779C, 0xE3DC, 0xE1F8, 0xE0F8, 0xF0F0, 0xFFF8, 0x7FFC, 0x1F0E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // ''' (ASCII 39)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '(' (ASCII 40)
  { 0x0000, 0x0000, 0x0000, 0x007C, 0x00FC, 0x01C0, 0x0380, 0x0700, 0x0700, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0600, 0x0700, 0x0780, 0x0380, 0x01E0, 0x00FC, 0x003C, 0x0000, 0x0000, 0x0000, 0x0000 },
  // ')' (ASCII 41)
  { 0x0000, 0x0000, 0x0000, 0x1E00, 0x1F80, 0x03C0, 0x01E0, 0x00E0, 0x0070, 0x0070, 0x0070, 0x0030, 0x0038, 0x0038, 0x0038, 0x0038, 0x0038, 0x0038, 0x0038, 0x0070, 0x0070, 0x0070, 0x00E0, 0x00E0, 0x01C0, 0x0780, 0x1F00, 0x1C00, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '*' (ASCII 42)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01C0, 0x01C0, 0x3184, 0x3DBC, 0x3FFE, 0x0FF8, 0x03C0, 0x07E0, 0x0F70, 0x1E38, 0x1C38, 0x0010, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '+' (ASCII 43)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x7FFE, 0x7FFE, 0x7FFE, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // ',' (ASCII 44)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01C0, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0300 },
  // '-' (ASCII 45)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7FFE, 0x7FFE, 0x7FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '.' (ASCII 46)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x03C0, 0x03C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '/' (ASCII 47)
  { 0x0000, 0x0000, 0x0000, 0x000E, 0x000E, 0x001C, 0x001C, 0x0018, 0x0038, 0x0038, 0x0070, 0x0070, 0x00E0, 0x00E0, 0x01C0, 0x01C0, 0x01C0, 0x0380, 0x0380, 0x0700, 0x0700, 0x0E00, 0x0E00, 0x0C00, 0x1C00, 0x1C00, 0x3800, 0x3800, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '0' (ASCII 48)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03E0, 0x0FF0, 0x1FF8, 0x1C3C, 0x3C1C, 0x381C, 0x380E, 0x380E, 0x3BCE, 0x3BCE, 0x3BCE, 0x388E, 0x380E, 0x381C, 0x3C1C, 0x1C3C, 0x1FF8, 0x0FF0, 0x03E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '1' (ASCII 49)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03C0, 0x1FC0, 0x1FC0, 0x1DC0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x3FFC, 0x3FFC, 0x3FFC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '2' (ASCII 50)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x1FF0, 0x3FF8, 0x383C, 0x101C, 0x001C, 0x001C, 0x001C, 0x0018, 0x0038, 0x0070, 0x0070, 0x01E0, 0x03C0, 0x0780, 0x1E00, 0x3FFE, 0x3FFE, 0x3FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '3' (ASCII 51)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x1FF8, 0x3FFC, 0x183C, 0x001C, 0x0018, 0x0038, 0x00F0, 0x07C0, 0x07F0, 0x0078, 0x001C, 0x001C, 0x001C, 0x001C, 0x203C, 0x3FF8, 0x3FF0, 0x1FC0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '4' (ASCII 52)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0018, 0x0E18, 0x1C18, 0x1C18, 0x1C18, 0x1C18, 0x1C18, 0x3818, 0x3818, 0x3818, 0x3818, 0x3818, 0x7FFE, 0x7FFE, 0x7FFE, 0x0018, 0x0018, 0x0018, 0x0018, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '5' (ASCII 53)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1FFC, 0x1FFC, 0x1FFC, 0x1C00, 0x1C00, 0x1C00, 0x1C00, 0x1FF8, 0x1FFC, 0x181C, 0x000E, 0x000E, 0x000E, 0x380E, 0x380E, 0x3C3C, 0x1FFC, 0x1FF8, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '6' (ASCII 54)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0038, 0x01F8, 0x07F8, 0x0FC0, 0x1E00, 0x1C00, 0x3C00, 0x39F0, 0x3BFC, 0x3FFC, 0x3C1E, 0x380E, 0x380E, 0x380E, 0x380E, 0x3C1C, 0x1FFC, 0x1FF8, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '7' (ASCII 55)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FFF, 0x3FFE, 0x3FFE, 0x301E, 0x301C, 0x301C, 0x303C, 0x0038, 0x0038, 0x0070, 0x0070, 0x0070, 0x00E0, 0x00E0, 0x00E0, 0x01C0, 0x01C0, 0x03C0, 0x0380, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '8' (ASCII 56)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x1FF8, 0x1FFC, 0x3C3C, 0x381C, 0x381C, 0x1C1C, 0x0FF0, 0x03E0, 0x1FF8, 0x3C3C, 0x381E, 0x380E, 0x300E, 0x380E, 0x3C1C, 0x3FFC, 0x1FF8, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '9' (ASCII 57)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x0FF8, 0x1FFC, 0x3C3C, 0x381E, 0x380E, 0x300E, 0x380E, 0x3C1E, 0x3FEE, 0x1FEE, 0x0FDC, 0x001C, 0x003C, 0x0078, 0x01F0, 0x1FE0, 0x1FC0, 0x1E00, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // ':' (ASCII 58)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x03C0, 0x03C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x03C0, 0x03C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // ';' (ASCII 59)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x03C0, 0x03C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01C0, 0x01C0, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0300 },
  // '<' (ASCII 60)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0004, 0x003C, 0x00FC, 0x07F8, 0x3FC0, 0x7E00, 0x7000, 0x7E00, 0x1FC0, 0x07F8, 0x00FC, 0x001C, 0x0004, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '=' (ASCII 61)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7FFE, 0x7FFE, 0x7FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x7FFE, 0x7FFE, 0x7FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '>' (ASCII 62)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3000, 0x3C00, 0x3F80, 0x0FE0, 0x03FC, 0x007E, 0x000E, 0x007E, 0x03FC, 0x1FE0, 0x3F00, 0x3C00, 0x2000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '?' (ASCII 63)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x1FF8, 0x3FF8, 0x3C3C, 0x101C, 0x001C, 0x0038, 0x0078, 0x00F0, 0x01C0, 0x0380, 0x0380, 0x0380, 0x0000, 0x0000, 0x0380, 0x03C0, 0x03C0, 0x0380, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '@' (ASCII 64)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03E0, 0x0FF8, 0x1E3C, 0x181C, 0x380C, 0x31EE, 0x33FE, 0x33FE, 0x338E, 0x370E, 0x770E, 0x770E, 0x770E, 0x330E, 0x339E, 0x33FE, 0x31EE, 0x3840, 0x3800, 0x1C00, 0x0E00, 0x07F0, 0x03F0, 0x0000, 0x0000 },
  // 'A' (ASCII 65)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03C0, 0x03E0, 0x07E0, 0x0760, 0x0670, 0x0670, 0x0E70, 0x0E30, 0x0C38, 0x1C38, 0x1C18, 0x1FFC, 0x1FFC, 0x3FFC, 0x380C, 0x300E, 0x700E, 0x7006, 0x7007, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'B' (ASCII 66)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FE0, 0x3FF8, 0x3FFC, 0x383C, 0x381C, 0x381C, 0x383C, 0x3FF8, 0x3F80, 0x3FF8, 0x381E, 0x380E, 0x3806, 0x3806, 0x380E, 0x381E, 0x3FFE, 0x3FFC, 0x3FF0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'C' (ASCII 67)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01F8, 0x07FE, 0x1FFE, 0x1E0C, 0x3C00, 0x3800, 0x7800, 0x7000, 0x7000, 0x7000, 0x7000, 0x7000, 0x7800, 0x3800, 0x3C00, 0x1F02, 0x1FFE, 0x0FFE, 0x01FC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'D' (ASCII 68)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FC0, 0x3FF0, 0x3FF8, 0x387C, 0x381E, 0x380E, 0x380E, 0x380E, 0x3806, 0x3806, 0x3806, 0x380E, 0x380E, 0x380E, 0x381E, 0x387C, 0x3FF8, 0x3FF0, 0x3FC0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'E' (ASCII 69)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FFE, 0x3FFE, 0x3FFE, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3FF8, 0x3FF8, 0x3FF8, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3FFE, 0x3FFE, 0x3FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'F' (ASCII 70)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FFE, 0x3FFE, 0x3FFE, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3FF8, 0x3FF8, 0x3FF8, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'G' (ASCII 71)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03F8, 0x0FFE, 0x1FFE, 0x3E0C, 0x3C00, 0x7800, 0x7000, 0x7000, 0x7000, 0x70FE, 0x70FE, 0x70FE, 0x700E, 0x780E, 0x3C0E, 0x3E0E, 0x1FFE, 0x0FFE, 0x03F8, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'H' (ASCII 72)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x3FFE, 0x3FFE, 0x3FFE, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'I' (ASCII 73)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FFC, 0x3FFC, 0x3FFC, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x3FFC, 0x3FFC, 0x3FFC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'J' (ASCII 74)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x01FE, 0x01FE, 0x01FE, 0x000E, 0x000E, 0x000E, 0x000E, 0x000E, 0x000E, 0x000E, 0x000E, 0x000E, 0x700E, 0x700C, 0x701C, 0x381C, 0x3C38, 0x1FF8, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'K' (ASCII 75)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x380E, 0x380E, 0x380E, 0x380E, 0x381C, 0x381C, 0x383C, 0x3838, 0x3870, 0x39F0, 0x3FE0, 0x3FF0, 0x3E70, 0x3838, 0x3838, 0x381C, 0x381E, 0x380E, 0x380F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'L' (ASCII 76)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3FFE, 0x3FFE, 0x3FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'M' (ASCII 77)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3C3E, 0x3C3E, 0x3E3E, 0x366E, 0x366E, 0x366E, 0x336E, 0x33CE, 0x33CE, 0x31CE, 0x31CE, 0x300E, 0x300E, 0x300E, 0x300E, 0x300E, 0x300E, 0x300E, 0x300E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'N' (ASCII 78)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3C0C, 0x3C0C, 0x3E0C, 0x3E0C, 0x3E0C, 0x3B0C, 0x3B0C, 0x3B8C, 0x398C, 0x398C, 0x39CC, 0x38CC, 0x38EC, 0x386C, 0x387C, 0x387C, 0x383C, 0x383C, 0x381C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'O' (ASCII 79)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x0FF8, 0x1FFC, 0x3C3C, 0x381E, 0x780E, 0x700E, 0x700E, 0x700E, 0x700E, 0x700E, 0x700E, 0x700E, 0x780E, 0x381E, 0x3C3C, 0x1FFC, 0x0FF8, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'P' (ASCII 80)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FE0, 0x3FF8, 0x3FFC, 0x381E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x381E, 0x3FFC, 0x3FF8, 0x3FE0, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'Q' (ASCII 81)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x0FF8, 0x1FFC, 0x3C3C, 0x381E, 0x780E, 0x700E, 0x700E, 0x700E, 0x700E, 0x700E, 0x700E, 0x700E, 0x780E, 0x381E, 0x3C3C, 0x1FFC, 0x0FF8, 0x07E0, 0x0180, 0x01C0, 0x01C0, 0x00E0, 0x00FC, 0x003C },
  // 'R' (ASCII 82)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FF0, 0x3FF8, 0x3FFC, 0x381E, 0x380E, 0x380E, 0x380E, 0x380E, 0x381C, 0x3FFC, 0x3FF8, 0x3FF0, 0x3870, 0x3838, 0x3838, 0x381C, 0x381C, 0x380E, 0x380E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'S' (ASCII 83)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x0FF8, 0x1FFC, 0x3C18, 0x3800, 0x3800, 0x3C00, 0x1E00, 0x0FC0, 0x07F0, 0x01F8, 0x007C, 0x001C, 0x001C, 0x001C, 0x301C, 0x3FFC, 0x3FF8, 0x0FE0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'T' (ASCII 84)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7FFE, 0x7FFE, 0x7FFE, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'U' (ASCII 85)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x381C, 0x381C, 0x3C3C, 0x1FFC, 0x0FF8, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'V' (ASCII 86)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7007, 0x700E, 0x700E, 0x380E, 0x380E, 0x381C, 0x381C, 0x1C1C, 0x1C18, 0x1C38, 0x0C38, 0x0E38, 0x0E70, 0x0E70, 0x0670, 0x0760, 0x07E0, 0x03E0, 0x03C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'W' (ASCII 87)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC00E, 0xC00E, 0xC00E, 0xC00E, 0xE38E, 0xE38E, 0xE38C, 0xE78C, 0xE79C, 0xE69C, 0xE69C, 0x66DC, 0x66DC, 0x64DC, 0x7CD8, 0x7CD8, 0x7CD8, 0x7C78, 0x7C78, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'X' (ASCII 88)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x700E, 0x381E, 0x381C, 0x1C38, 0x0E38, 0x0E70, 0x0760, 0x03E0, 0x03C0, 0x01C0, 0x03C0, 0x03E0, 0x0760, 0x0E70, 0x0E38, 0x1C38, 0x3C1C, 0x381E, 0x700E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'Y' (ASCII 89)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xE00E, 0xE01C, 0x701C, 0x7038, 0x3838, 0x3870, 0x1C70, 0x1CE0, 0x0EE0, 0x0FC0, 0x07C0, 0x0780, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'Z' (ASCII 90)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FFC, 0x3FFC, 0x3FFC, 0x001C, 0x0038, 0x0078, 0x00F0, 0x00E0, 0x01E0, 0x03C0, 0x0380, 0x0780, 0x0F00, 0x0E00, 0x1C00, 0x3C00, 0x3FFE, 0x3FFE, 0x3FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '[' (ASCII 91)
  { 0x0000, 0x0000, 0x0000, 0x07FC, 0x07FC, 0x07FC, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x07FC, 0x07FC, 0x07FC, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '\' (ASCII 92)
  { 0x0000, 0x0000, 0x0000, 0x7000, 0x3800, 0x3800, 0x3800, 0x1C00, 0x1C00, 0x0E00, 0x0E00, 0x0700, 0x0700, 0x0300, 0x0380, 0x0380, 0x01C0, 0x01C0, 0x00E0, 0x00E0, 0x0070, 0x0070, 0x0030, 0x0038, 0x0038, 0x001C, 0x001C, 0x000E, 0x0000, 0x0000, 0x0000, 0x0000 },
  // ']' (ASCII 93)
  { 0x0000, 0x0000, 0x0000, 0x1FE0, 0x1FE0, 0x1FE0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x1FE0, 0x1FE0, 0x1FE0, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '^' (ASCII 94)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03C0, 0x03E0, 0x07E0, 0x0770, 0x0E70, 0x0E38, 0x1C38, 0x1C38, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '_' (ASCII 95)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7FFE, 0x7FFE, 0x7FFE, 0x0000, 0x0000, 0x0000 },
  // '`' (ASCII 96)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0700, 0x0780, 0x0380, 0x0380, 0x01C0, 0x01C0, 0x00E0, 0x00E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'a' (ASCII 97)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1FC0, 0x1FF0, 0x1FF0, 0x0078, 0x0038, 0x0018, 0x0FF8, 0x1FF8, 0x3818, 0x7018, 0x7038, 0x7038, 0x387F, 0x3FDF, 0x1F9F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'b' (ASCII 98)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x39F0, 0x3BF8, 0x3E1C, 0x3C0E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x381C, 0x381C, 0x3878, 0x3FF0, 0x3FC0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'c' (ASCII 99)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03F0, 0x0FFC, 0x1FFE, 0x1E1C, 0x3C00, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3C00, 0x1E00, 0x1FFC, 0x0FFC, 0x03FC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'd' (ASCII 100)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x001C, 0x001C, 0x001C, 0x001C, 0x001C, 0x001C, 0x079C, 0x1FDC, 0x3C7C, 0x383C, 0x381C, 0x701C, 0x701C, 0x701C, 0x701C, 0x701C, 0x381C, 0x383C, 0x3C3C, 0x1FDC, 0x0F9C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'e' (ASCII 101)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07E0, 0x0FF0, 0x1FF8, 0x3C3C, 0x381C, 0x380C, 0x300C, 0x3FFC, 0x3FFC, 0x3800, 0x3800, 0x1E00, 0x1FF8, 0x0FFC, 0x03FC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'f' (ASCII 102)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x007E, 0x00FE, 0x01FE, 0x03C0, 0x0380, 0x0380, 0x0300, 0x0700, 0x0700, 0x7FFC, 0x7FFC, 0x7FFC, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'g' (ASCII 103)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079C, 0x1FFC, 0x3C7C, 0x383C, 0x381C, 0x701C, 0x701C, 0x701C, 0x701C, 0x701C, 0x381C, 0x383C, 0x3C3C, 0x1FDC, 0x0F9C, 0x001C, 0x003C, 0x0078, 0x3FF8, 0x3FF0, 0x3F80 },
  // 'h' (ASCII 104)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x39F0, 0x3BF8, 0x3A3C, 0x3C1C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'i' (ASCII 105)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x00C0, 0x01E0, 0x01E0, 0x00C0, 0x0000, 0x0000, 0x1FE0, 0x1FE0, 0x1FE0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x00E0, 0x3FFE, 0x3FFE, 0x3FFE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'j' (ASCII 106)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0070, 0x00F0, 0x00F0, 0x0070, 0x0000, 0x0000, 0x0FF0, 0x0FF0, 0x0FF0, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x0070, 0x00F0, 0x03E0, 0x3FE0, 0x3FC0, 0x3E00 },
  // 'k' (ASCII 107)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x380E, 0x381C, 0x381C, 0x381C, 0x3838, 0x3878, 0x3FF0, 0x3FE0, 0x3FF0, 0x3878, 0x3838, 0x383C, 0x381C, 0x381E, 0x380E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'l' (ASCII 108)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7F80, 0x7F80, 0x7F80, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x0380, 0x03FC, 0x01FE, 0x00FC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'm' (ASCII 109)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x373C, 0x37BE, 0x39CE, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x318E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'n' (ASCII 110)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x39F0, 0x3BF8, 0x3FFC, 0x3E3C, 0x3C1C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'o' (ASCII 111)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03E0, 0x0FF0, 0x1FF8, 0x1C3C, 0x3C1C, 0x381C, 0x381E, 0x380E, 0x381E, 0x381C, 0x3C1C, 0x1C3C, 0x1FF8, 0x0FF0, 0x07E0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'p' (ASCII 112)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x39F0, 0x3BF8, 0x3E3C, 0x3C1C, 0x3C0E, 0x380E, 0x380E, 0x380E, 0x380E, 0x380E, 0x3C0E, 0x3C1E, 0x3A3C, 0x3BF8, 0x39F0, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800, 0x3800 },
  // 'q' (ASCII 113)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079C, 0x1FDC, 0x3C3C, 0x381C, 0x381C, 0x701C, 0x701C, 0x701C, 0x701C, 0x701C, 0x381C, 0x381C, 0x3C3C, 0x1FFC, 0x079C, 0x001C, 0x001C, 0x001C, 0x001C, 0x001C, 0x001C },
  // 'r' (ASCII 114)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3E7C, 0x3EFE, 0x3E8E, 0x0F07, 0x0F07, 0x0E07, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x0E00, 0x7FE0, 0x7FE0, 0x7FE0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 's' (ASCII 115)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x03FC, 0x0FFC, 0x1FFC, 0x3C00, 0x3800, 0x3C00, 0x1FC0, 0x0FF8, 0x01FC, 0x001C, 0x001C, 0x001C, 0x3FFC, 0x3FF8, 0x3FE0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 't' (ASCII 116)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0700, 0x0700, 0x0700, 0x0700, 0x7FFC, 0x7FFC, 0x7FFC, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0700, 0x0780, 0x07FC, 0x03FE, 0x00FE, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'u' (ASCII 117)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x381C, 0x383C, 0x3C3C, 0x1FDF, 0x1FDF, 0x0F9F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'v' (ASCII 118)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x700E, 0x380E, 0x381C, 0x381C, 0x1C1C, 0x1C18, 0x1C38, 0x0C38, 0x0E30, 0x0E70, 0x0670, 0x0760, 0x07E0, 0x03E0, 0x03C0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'w' (ASCII 119)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7186, 0x71CE, 0x73CE, 0x73CE, 0x73CE, 0x33CE, 0x324E, 0x324C, 0x326C, 0x366C, 0x3E6C, 0x3E7C, 0x3E7C, 0x3E3C, 0x1C38, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'x' (ASCII 120)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x381E, 0x3C1C, 0x1C38, 0x0E78, 0x0770, 0x07E0, 0x03C0, 0x01C0, 0x03C0, 0x07E0, 0x0770, 0x0E78, 0x1C38, 0x3C1C, 0x381E, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // 'y' (ASCII 121)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x700E, 0x700E, 0x381C, 0x381C, 0x381C, 0x1C1C, 0x1C38, 0x0C38, 0x0E38, 0x0E70, 0x0770, 0x0770, 0x0360, 0x03E0, 0x03E0, 0x01C0, 0x03C0, 0x0F80, 0x7F00, 0x7E00, 0x7800 },
  // 'z' (ASCII 122)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3FFC, 0x3FFC, 0x3FFC, 0x0038, 0x0078, 0x00F0, 0x01E0, 0x03C0, 0x0780, 0x0F00, 0x0E00, 0x1C00, 0x3FFC, 0x3FFC, 0x3FFC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '{' (ASCII 123)
  { 0x0000, 0x0000, 0x0000, 0x00F8, 0x01F8, 0x01F8, 0x03C0, 0x0380, 0x01C0, 0x01C0, 0x01C0, 0x00E0, 0x01E0, 0x03C0, 0x1F00, 0x1F00, 0x03C0, 0x00E0, 0x00E0, 0x01C0, 0x01C0, 0x01C0, 0x0380, 0x0380, 0x03C0, 0x01F8, 0x00F8, 0x0078, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '|' (ASCII 124)
  { 0x0000, 0x0000, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x01C0, 0x0000, 0x0000 },
  // '}' (ASCII 125)
  { 0x0000, 0x0000, 0x0000, 0x1F00, 0x1F80, 0x1FC0, 0x01C0, 0x01C0, 0x01C0, 0x0380, 0x0380, 0x0380, 0x0380, 0x03C0, 0x00F8, 0x00F8, 0x03C0, 0x0380, 0x0380, 0x0380, 0x0380, 0x01C0, 0x01C0, 0x01C0, 0x03C0, 0x1FC0, 0x1F80, 0x1E00, 0x0000, 0x0000, 0x0000, 0x0000 },
  // '~' (ASCII 126)
  { 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1E0E, 0x3F8E, 0x3FCE, 0x79FE, 0x70FC, 0x7038, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000 },
};


/**
 * Draw a single character using 16x32 font 
 */
void draw_char_16x32(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, char c, int8_t pixel) 
{
    int char_index = c-0x20;
	if ((c<' ')|(c>'~')) return;
        
    for (int row = 0; row < 32; row++) {
        uint16_t row_data = cascadia_font_16x32[char_index][row];
        
        // Draw 8 pixels from the byte (can be extended to 12 if needed)
        for (int col = 0; col < 16; col++) {
            if (row_data & (0x8000 >> col)) {
                LCD_SetPixel(hlcd, x + col, y + row, pixel);
            }
        }
    }
}


/**
 * Draw a single character using 12x24 font 
 */
void draw_char_12x24(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, char c, int8_t pixel) 
{
    int char_index = c-0x20;
	if ((c<' ')|(c>'~')) return;
        
    for (int row = 0; row < 24; row++) {
        uint16_t row_data = cascadia_font_12x24[char_index][row];
        
        // Draw 8 pixels from the byte (can be extended to 12 if needed)
        for (int col = 0; col < 12; col++) {
            if (row_data & (0x800 >> col)) {
                LCD_SetPixel(hlcd, x + col, y + row, pixel);
            }
        }
    }
}



/**
 * Display text string using 16x32 font
 */
void display_text_16x32(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, const char* text, int8_t pixel) {
    uint16_t cursor_x = x;
    uint16_t cursor_y = y;
    
    for (int i = 0; text[i] != '\0'; i++) {
        if (text[i] == '\n') {
            // New line
            cursor_x = x;
            cursor_y += 32; // 32 pixels height + 0 pixels spacing
        } else {
            // Draw character
            draw_char_16x32(hlcd, cursor_x, cursor_y, text[i], pixel);
            cursor_x += 16; // 16 pixels width + 0 pixels spacing (or 14 for full 12-bit width)
        }
    }
}


/**
 * Display text string using 12x24 font
 */
void display_text_12x24(LCD_Handle_t *hlcd, uint16_t x, uint16_t y, const char* text, int8_t pixel) {
    uint16_t cursor_x = x;
    uint16_t cursor_y = y;
    
    for (int i = 0; text[i] != '\0'; i++) {
        if (text[i] == '\n') {
            // New line
            cursor_x = x;
            cursor_y += 26; // 24 pixels height + 2 pixels spacing
        } else {
            // Draw character
            draw_char_12x24(hlcd, cursor_x, cursor_y, text[i], pixel);
            cursor_x += 12; // 12 pixels width + 0 pixels spacing (or 14 for full 12-bit width)
        }
    }
}


/**
 * @brief Initialize the LCD driver
 * @param hlcd: LCD handle
 * @param hspi: SPI handle (must be pre-configured)
 * @param use_dma: Enable DMA transfers
 * @retval LCD_Status_t
 */
LCD_Status_t LCD_Initold(LCD_Handle_t *hlcd, SPI_HandleTypeDef *hspi, bool use_dma)
{
    if (!hlcd || !hspi) {
        return LCD_ERROR;
    }



    /* Initialize handle */
    memset(hlcd, 0, sizeof(LCD_Handle_t));
    hlcd->config.hspi = hspi;
    hlcd->config.use_dma = use_dma;
    hlcd->config.timeout_ms = 1000;
    hlcd->vcom_state = false;
    hlcd->transfer_complete = true;

    /* Initialize modified lines tracking */
    memset(&hlcd->modified, 0, sizeof(LCD_ModifiedLines_t));
    hlcd->modified.first_modified = LCD_HEIGHT;
    hlcd->modified.last_modified = 0;

    /* Set global handle for DMA callback */
    g_hlcd = hlcd;

    /* Verify SPI configuration */
    if (hspi->Init.DataSize != SPI_DATASIZE_8BIT) {
        return LCD_ERROR;
    }
HAL_StatusTypeDef status2;
//	status2 = HAL_SPI_RegisterCallback(hspi, HAL_SPI_TX_COMPLETE_CB_ID, &LCD_SPI_TxCpltCallback);


#ifdef  DEBUG_LCD
	SEGGER_RTT_printf(0, "\nSPI2 register CB (0 = ok) %02x ", (int)status2 );
#endif
	if (status2 != HAL_OK)	{
        return LCD_ERROR;
    }
    /* Clear static buffers */
    memset(lcd_framebuffer, 0, LCD_TOTAL_BYTES);
    memset(lcd_dma_buffer, 0, LCD_MAX_DMA_SIZE);
 
    hlcd->initialized = true; // LCD_Clear() check initialized !

    /* Clear display */
    LCD_Status_t status = LCD_Clear(hlcd);
    if (status != LCD_OK) {
        return status;
    }

    return LCD_OK;
}
